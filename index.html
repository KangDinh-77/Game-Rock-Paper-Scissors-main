<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>O·∫≥n T√π T√¨ ‚Äî Realtime</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
  --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#7c3aed; --ok:#10b981; --danger:#ef4444;
  --glass: rgba(255,255,255,0.03);
}
*{box-sizing:border-box}
body{
  font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;
  margin:0; min-height:100vh; background:linear-gradient(180deg,#071023 0%, #0b1b2b 100%);
  color:#e6eef8; display:flex; align-items:center; justify-content:center; padding:32px;
}
.container{
  width:100%; max-width:1100px; background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
  border:1px solid rgba(255,255,255,0.04); border-radius:14px; padding:20px; display:grid;
  grid-template-columns: 280px 1fr 320px; gap:20px; box-shadow: 0 10px 40px rgba(2,6,23,0.7);
}
.panel { background:var(--card); padding:16px; border-radius:10px; }
.header { display:flex; align-items:center; gap:12px; margin-bottom:12px; }
.logo {
  width:44px; height:44px; border-radius:10px; background:linear-gradient(135deg,var(--accent),#4f46e5);
  display:flex; align-items:center; justify-content:center; font-weight:700; color:white; font-size:18px;
  box-shadow: 0 6px 20px rgba(124,58,237,0.18);
}
.title { font-weight:600; font-size:16px; color:#dbeafe; }
.subtitle { color:var(--muted); font-size:12px; margin-top:2px; }
.players-list { list-style:none; padding:0; margin:8px 0 0 0; display:flex; flex-direction:column; gap:8px; }
.player { display:flex; align-items:center; gap:10px; padding:8px; border-radius:8px; background:var(--glass); }
.avatar { width:36px; height:36px; border-radius:8px; background:linear-gradient(135deg,#06b6d4,#7c3aed); display:flex; align-items:center; justify-content:center; color:white; font-weight:600;}
.player .name { font-weight:600; color:#e6eef8; }
.player .meta { color:var(--muted); font-size:12px; margin-left:auto; }
.game-area { display:flex; flex-direction:column; gap:12px; }
.controls { display:flex; gap:12px; align-items:center; }
.input { flex:1; display:flex; gap:8px; }
input[type="text"]{ flex:1; padding:10px 12px; border-radius:8px; border:none; background:rgba(255,255,255,0.02); color:inherit; outline:none; }
.btn { background:var(--accent); color:white; padding:10px 14px; border-radius:10px; border:none; cursor:pointer; font-weight:600; box-shadow: 0 8px 24px rgba(99,102,241,0.12);}
.btn.secondary{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); box-shadow:none; }
.status { font-size:13px; color:var(--muted); display:flex; align-items:center; gap:8px; }
.indicator { width:10px; height:10px; border-radius:50%; background:var(--danger); box-shadow:0 0 8px rgba(239,68,68,0.2); }
.choices { display:flex; gap:12px; justify-content:center; margin-top:6px; }
.choice-btn { padding:14px 18px; border-radius:12px; border:none; font-weight:700; cursor:pointer; color:#071023; min-width:110px; display:flex; gap:8px; align-items:center; justify-content:center; box-shadow:0 8px 18px rgba(2,6,23,0.6); transform:translateY(0); transition:transform .12s ease, box-shadow .12s ease, opacity .12s ease; }
.choice-btn:active{ transform:translateY(2px); }
.choice-rock{ background:#ffd166; }
.choice-paper{ background:#90ee90; }
.choice-scissors{ background:#93c5fd; }
.choice-btn[disabled]{ opacity:0.5; cursor:not-allowed; transform:none; box-shadow:none; }
.result { background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); padding:12px; border-radius:10px; min-height:120px; color:#e6eef8; font-family:monospace; white-space:pre-wrap; overflow:auto; }
.log-title { display:flex; justify-content:space-between; align-items:center; gap:8px; margin-bottom:8px; }
.log { height:320px; background:linear-gradient(180deg, rgba(255,255,255,0.015), transparent); padding:12px; border-radius:8px; overflow:auto; color:var(--muted); font-size:13px; }
.footer { display:flex; gap:8px; margin-top:10px; }
.chat-input{ flex:1; padding:10px; border-radius:8px; border:none; background:rgba(255,255,255,0.02); color:inherit; }
.small { font-size:12px; color:var(--muted); }
@media (max-width:980px){
  .container{ grid-template-columns: 1fr; padding:16px; }
  .log{ height:220px; }
}
</style>
</head>
<body>
<div class="container">
  <div class="panel">
    <div class="header">
      <div class="logo">OTT</div>
      <div>
        <div class="title">O·∫≥n T√π T√¨ Realtime</div>
        <div class="subtitle">Ch∆°i ngay ‚Äî- 2 ng∆∞·ªùi / ph√≤ng</div>
      </div>
    </div>

    <div style="margin-top:8px;">
      <div class="small" style="margin-bottom:6px">T√™n c·ªßa b·∫°n</div>
      <div style="display:flex;gap:8px">
        <input id="name" type="text" placeholder="Nh·∫≠p t√™n..." />
        <button id="joinBtn" class="btn">Join</button>
      </div>
      <div class="status" style="margin-top:10px">
        <div class="indicator" id="connIndicator"></div>
        <div id="statusText">Ch∆∞a k·∫øt n·ªëi</div>
      </div>
    </div>

    <hr style="border:none;border-top:1px solid rgba(255,255,255,0.02);margin:12px 0" />

    <div class="small">Ng∆∞·ªùi ch∆°i trong ph√≤ng</div>
    <ul id="players" class="players-list" aria-live="polite"></ul>
  </div>

  <div class="panel game-area">
    <div style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <div style="font-weight:700;font-size:18px">V√≤ng ch∆°i</div>
      </div>
      <div class="small">Server: <span id="serverAddr">ws://localhost:8765</span></div>
    </div>

    <div class="controls">
      <div class="input small">B·∫°n s·∫Ω ch∆°i v·ªõi ai? (t·ª± ƒë·ªông gh√©p c·∫∑p)</div>
      <div style="margin-left:auto" class="small">Tr·∫°ng th√°i l·ª±a ch·ªçn: <span id="choiceState">‚Äî</span></div>
    </div>

    <div class="choices" role="group" aria-label="Choices">
      <button class="choice-btn choice-rock" data-choice="rock">‚úä Rock</button>
      <button class="choice-btn choice-paper" data-choice="paper">‚úã Paper</button>
      <button class="choice-btn choice-scissors" data-choice="scissors">‚úåÔ∏è Scissors</button>
    </div>

    <div class="result" id="result">K·∫øt qu·∫£ xu·∫•t hi·ªán ·ªü ƒë√¢y...</div>
  </div>

  <div class="panel">
    <div class="log-title">
      <div style="font-weight:700">Nh·∫≠t k√Ω & Chat</div>
    </div>

    <div id="log" class="log" aria-live="polite"></div>

    <div class="footer">
      <input id="chatInput" class="chat-input" placeholder="G√µ tin nh·∫Øn..." />
      <button id="sendChat" class="btn secondary">G·ª≠i</button>
    </div>
  </div>
</div>

<script>
/* WebSocket + UI logic */
let ws = null;
const joinBtn = document.getElementById('joinBtn');
const nameInput = document.getElementById('name');
const playersEl = document.getElementById('players');
const logEl = document.getElementById('log');
const resultEl = document.getElementById('result');
const connIndicator = document.getElementById('connIndicator');
const statusText = document.getElementById('statusText');
const choiceState = document.getElementById('choiceState');
const choiceBtns = Array.from(document.querySelectorAll('.choice-btn'));
const playersCount = document.getElementById('playersCount');
const chatInput = document.getElementById('chatInput');
const sendChat = document.getElementById('sendChat');
const serverAddr = document.getElementById('serverAddr');

function setConnected(v){
  connIndicator.style.background = v ? 'var(--ok)' : 'var(--danger)';
  connIndicator.style.boxShadow = v ? '0 8px 30px rgba(16,185,129,0.12)' : '0 8px 30px rgba(239,68,68,0.12)';
  statusText.textContent = v ? 'ƒê√£ k·∫øt n·ªëi' : 'Ng·∫Øt k·∫øt n·ªëi';
}

function log(text, kind='info'){
  const time = new Date().toLocaleTimeString();
  const span = document.createElement('div');
  span.innerHTML = `<strong style="color:var(--muted);font-weight:600">${time}</strong> ‚Äî ${text}`;
  logEl.appendChild(span);
  logEl.scrollTop = logEl.scrollHeight;
}

function updatePlayers(list){
  playersEl.innerHTML = '';
  list.forEach(p=>{
    const li = document.createElement('li');
    li.className='player';
    const av = document.createElement('div');
    av.className='avatar';
    av.textContent = (p[0]||'?').toUpperCase();
    const name = document.createElement('div');
    name.className='name';
    name.textContent = p;
    const meta = document.createElement('div');
    meta.className='meta';
    meta.textContent = 'online';
    li.appendChild(av); li.appendChild(name); li.appendChild(meta);
    playersEl.appendChild(li);
  });
  playersCount.textContent = `${list.length} ng∆∞·ªùi`;
}

function setButtonsEnabled(v){
  choiceBtns.forEach(b=>b.disabled = !v);
  choiceState.textContent = v ? 'S·∫µn s√†ng' : 'ƒêang ch·ªù...';
}

joinBtn.addEventListener('click', ()=>{
  const name = (nameInput.value || 'Anon').trim();
  if(!name) return;
  if(ws && ws.readyState===WebSocket.OPEN){ log('ƒê√£ c√≥ k·∫øt n·ªëi.'); return; }
  ws = new WebSocket(serverAddr.textContent.trim());

  ws.onopen = ()=> {
    setConnected(true);
    log('ƒê√£ k·∫øt n·ªëi ƒë·∫øn server');
    ws.send(JSON.stringify({type:'join', name}));
    setButtonsEnabled(true);
  };

  ws.onmessage = ev => {
    try{
      const msg = JSON.parse(ev.data);
      if(msg.type === 'players'){
        updatePlayers(msg.players || []);
      } else if(msg.type === 'system'){
        log(msg.text);
      } else if(msg.type === 'chat'){
        log(`üí¨ ${msg.from}: ${msg.text}`);
      } else if(msg.type === 'round_result'){
        let txt = '=== K·∫øt qu·∫£ v√≤ng n√†y ===\n';
        msg.results.forEach(r => txt += `${r.name}: ${r.choice} ‚Üí ${r.result}\n`);
        resultEl.textContent = txt;
        log('V√≤ng m·ªõi: k·∫øt qu·∫£ ƒë√£ c·∫≠p nh·∫≠t');
        setButtonsEnabled(true);
      } else if(msg.type === 'error'){
        log('‚ùå ' + msg.text);
      }
    }catch(e){
      console.error('invalid message', e);
    }
  };

  ws.onclose = ()=> {
    setConnected(false);
    log('Ng·∫Øt k·∫øt n·ªëi');
    setButtonsEnabled(false);
  };

  ws.onerror = ()=> {
    log('L·ªói k·∫øt n·ªëi');
  };
});

choiceBtns.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    const choice = btn.getAttribute('data-choice');
    sendChoice(choice);
  });
});

function sendChoice(choice){
  if(!ws || ws.readyState !== WebSocket.OPEN){
    log('‚ùå Ch∆∞a k·∫øt n·ªëi t·ªõi server');
    return;
  }
  ws.send(JSON.stringify({type:'choice', choice}));
  log(`B·∫°n ƒë√£ ch·ªçn: ${choice}`);
  setButtonsEnabled(false);
}

sendChat.addEventListener('click', ()=>{
  const t = chatInput.value.trim();
  if(!t) return;
  if(!ws || ws.readyState !== WebSocket.OPEN){ log('‚ùå Ch∆∞a k·∫øt n·ªëi'); return; }
  ws.send(JSON.stringify({type:'chat', text:t}));
  chatInput.value='';
});

nameInput.addEventListener('keydown', e=>{ if(e.key==='Enter') joinBtn.click(); });
chatInput.addEventListener('keydown', e=>{ if(e.key==='Enter') sendChat.click(); });

setConnected(false);
setButtonsEnabled(false);
resultEl.textContent = 'Ch∆∞a c√≥ k·∫øt qu·∫£. H√£y join ƒë·ªÉ b·∫Øt ƒë·∫ßu.';
log('·ª®ng d·ª•ng s·∫µn s√†ng. Nh·∫≠p t√™n v√† nh·∫•n Join.');
</script>
</body>
</html>